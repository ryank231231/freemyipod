# nothing         center          right           center+right    left            center+left     left+right     center+left+right
.word(fastboot) .word(entry)    .word(entry)    .word(console)  .word(entry)    .word(entry)    .word(entry)    .word(entry)   
.word(rockbox)  .word(umsboot)  .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    # +play
.word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    # +menu
.word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    .word(entry)    # +play+menu

# error handler
.word(0xffffffff)

console:
  terminate()

poweroff:
  poweroff()

umsboot:
  readflash(0x08000000, "umsboot ")
  exec(0x08000000)
  
fastboot:
  error(entry)
  jmp(rockboxcommon)

rockbox:
  error(rockboxuncompressed)
rockboxcommon:
  readfile(0x09000000, "/iloader/rockbox.ucl\0")
  unpackucl(0x09000000, 0x08000000)
  exec(0x08000000)
rockboxuncompressed:
  error(rockboxerror)
  readfile(0x08000000, "/.rockbox/rockbox.ipod\0")
  rbchecksum(0x08000000)
  exec(0x08000000)
rockboxerror:
  error(0xffffffff)
  fillrect(0, 0, 195, 240, 0xffff)
  text(16, 16, 0x0000, 0xffff, "Rockbox does not seem\0")
  text(16, 24, 0x0000, 0xffff, "to be installed.\0")
  text(16, 32, 0x0000, 0xffff, "You need to extract it\0")
  text(16, 40, 0x0000, 0xffff, "to the root directory\0")
  text(16, 48, 0x0000, 0xffff, "of your iPod.\0")
  text(16, 64, 0x0000, 0xffff, "Press any key to\0")
  text(16, 72, 0x0000, 0xffff, "return to the menu.\0")
  blit()
  button(menu, menu, menu, menu, menu, 0)

entry:
  readfile(0x08000000, "/iLoader/theme.ucl\0")
  unpackucl(0x08000000, 0x09000000)
  displaybmp(195, 0, 0x09000000)
menu:
  fillrect(0, 0, 195, 240, 0xffff)
  displaybmp(0, 0, 0x0900ec88)
  blit()
  menu(mainmenu, 0, 0xffffffff, 0xfffffffe, 0xffffffff, 0xfffffffe, 0)

mainmenu:
  .menuentry(0x0901a490, 0, 0, 0, 0, 0, 0, rockbox)
  .menuentry(0x0901cb20, 0, 25, 0, 0, 0, 0, console)
  .menuentry(0x0901f1b0, 0, 50, 0, 0, 0, 0, poweroff)
  .menuentry(0x09021840, 0, 75, 0, 0, 0, 0, umsboot)
  .menuentry(0x09023ed0, 0, 100, 0, 0, 0, 0, 0xffffffff)
  .word(0)
